(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,72436,48425,e=>{"use strict";var t=e.i(43476),r=e.i(71645);e.i(74080);var a=e.i(91918),i=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"].reduce((e,i)=>{let s=(0,a.createSlot)(`Primitive.${i}`),n=r.forwardRef((e,r)=>{let{asChild:a,...n}=e;return"undefined"!=typeof window&&(window[Symbol.for("radix-ui")]=!0),(0,t.jsx)(a?s:i,{...n,ref:r})});return n.displayName=`Primitive.${i}`,{...e,[i]:n}},{});e.s(["Primitive",()=>i],48425);var s="horizontal",n=["horizontal","vertical"],l=r.forwardRef((e,r)=>{var a;let{decorative:l,orientation:o=s,...d}=e,c=(a=o,n.includes(a))?o:s;return(0,t.jsx)(i.div,{"data-orientation":c,...l?{role:"none"}:{"aria-orientation":"vertical"===c?c:void 0,role:"separator"},...d,ref:r})});l.displayName="Separator";var o=e.i(75157);function d({className:e,orientation:r="horizontal",decorative:a=!0,...i}){return(0,t.jsx)(l,{"data-slot":"separator",decorative:a,orientation:r,className:(0,o.cn)("bg-border shrink-0 data-[orientation=horizontal]:h-px data-[orientation=horizontal]:w-full data-[orientation=vertical]:h-full data-[orientation=vertical]:w-px",e),...i})}e.s(["Separator",()=>d],72436)},15288,e=>{"use strict";var t=e.i(43476),r=e.i(75157);function a({className:e,...a}){return(0,t.jsx)("div",{"data-slot":"card",className:(0,r.cn)("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",e),...a})}function i({className:e,...a}){return(0,t.jsx)("div",{"data-slot":"card-header",className:(0,r.cn)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-2 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",e),...a})}function s({className:e,...a}){return(0,t.jsx)("div",{"data-slot":"card-title",className:(0,r.cn)("leading-none font-semibold",e),...a})}function n({className:e,...a}){return(0,t.jsx)("div",{"data-slot":"card-content",className:(0,r.cn)("px-6",e),...a})}e.s(["Card",()=>a,"CardContent",()=>n,"CardHeader",()=>i,"CardTitle",()=>s])},93479,e=>{"use strict";var t=e.i(43476),r=e.i(75157);function a({className:e,type:a,...i}){return(0,t.jsx)("input",{type:a,"data-slot":"input",className:(0,r.cn)("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",e),...i})}e.s(["Input",()=>a])},24687,e=>{"use strict";var t=e.i(43476),r=e.i(75157);function a({className:e,...a}){return(0,t.jsx)("textarea",{"data-slot":"textarea",className:(0,r.cn)("border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e),...a})}e.s(["Textarea",()=>a])},4303,e=>{"use strict";let t="https://api.whatsonchain.com/v1/bsv/main";function r(e){let t=e=>{let t=new ArrayBuffer(4);return new DataView(t).setUint32(0,e,!0),Array.from(new Uint8Array(t)).map(e=>e.toString(16).padStart(2,"0")).join("")},r=e=>(e.match(/.{2}/g)??[]).reverse().join(""),a=parseInt(e.bits,16);return[t(e.version),r(e.prevBlockHash.padStart(64,"0")),r(e.merkleRoot.padStart(64,"0")),t(e.time),t(a),t(e.nonce)].join("")}async function a(e,r){try{let a=await fetch(`${t}/block/height/${e}`,{signal:r});if(!a.ok)return null;let i=await a.json();return{hash:i.hash,height:i.height,version:i.version,prevBlockHash:i.previousblockhash??"",merkleRoot:i.merkleroot,time:i.time,bits:i.bits,nonce:i.nonce}}catch{return null}}async function i(e){try{let r=await fetch(`${t}/chain/info`,{signal:e});if(!r.ok)return null;return(await r.json()).blocks??null}catch{return null}}let s=[{name:"WhatsOnChain",fetchTip:i,fetchHeader:a}];async function n(e){let t=[],r=s.map(async t=>{try{let r=await t.fetchTip(e);return{source:t.name,height:r}}catch{return{source:t.name,height:null}}});t.push(...await Promise.all(r));let a=t.filter(e=>null!==e.height);if(0===a.length)return{height:null,consensus:!1,sources:[]};if(1===a.length)return{height:a[0].height,consensus:!1,sources:[a[0].source]};let i=new Map;for(let e of a)if(null!==e.height){let t=i.get(e.height)||[];t.push(e.source),i.set(e.height,t)}let n=null,l=[];for(let[e,t]of i)t.length>=2&&t.length>l.length&&(n=e,l=t);if(null!==n)return{height:n,consensus:!0,sources:l};let o=a.reduce((e,t)=>(t.height??0)>(e.height??0)?t:e);return{height:o.height,consensus:!1,sources:[o.source]}}async function l(e,r){try{let a=await fetch(`${t}/tx/${e}/hex`,{signal:r});if(!a.ok)return null;return await a.text()}catch{return null}}async function o(r,a){try{let{Beef:i,MerklePath:s,Transaction:n}=await e.A(28627),o=await l(r,a);if(!o)return console.warn(`[assembleBeef] Could not fetch raw tx for ${r}`),null;let d=await fetch(`${t}/tx/${r}/proof/tsc`,{signal:a});if(!d.ok)return console.warn(`[assembleBeef] Could not fetch TSC proof for ${r}`),null;let c=await d.json(),h=Array.isArray(c)?c[0]:c;if(!h||"number"!=typeof h.index||!Array.isArray(h.nodes))return console.warn(`[assembleBeef] Invalid TSC proof format for ${r}`,h),null;let u="height"===h.targetType?h.target:h.blockHeight??0;if(!u){let e=h.target;if(e&&"string"==typeof e&&64===e.length){let r=await fetch(`${t}/block/hash/${e}`,{signal:a});if(r.ok){let e=await r.json();e.height&&(h.blockHeight=e.height)}}}let f=h.blockHeight??u;if(!f)return console.warn(`[assembleBeef] Could not determine block height for ${r}`),null;let g=[],x=h.index,m=[{offset:x,hash:r,txid:!0}];if(h.nodes.length>0){let e=h.nodes[0],t=x%2==0?x+1:x-1;"*"===e?m.push({offset:t,duplicate:!0}):m.push({offset:t,hash:e})}g.push(m),x=Math.floor(x/2);for(let e=1;e<h.nodes.length;e++){let t=h.nodes[e],r=x%2==0?x+1:x-1,a=[];"*"===t?a.push({offset:r,duplicate:!0}):a.push({offset:r,hash:t}),g.push(a),x=Math.floor(x/2)}let p=new s(f,g);p.computeRoot(r);let v=n.fromHex(o);v.merklePath=p;let b=new i;return b.mergeTransaction(v),{beefHex:b.toHex(),height:f}}catch(e){return console.error(`[assembleBeef] Error assembling BEEF for ${r}:`,e),null}}e.s(["assembleBeefFromTxid",()=>o,"constructHeaderHex",()=>r,"fetchChainTip",()=>i,"fetchChainTipMultiSource",()=>n,"fetchHeaderByHeight",()=>a,"fetchRawTx",()=>l])},18566,(e,t,r)=>{t.exports=e.r(76562)},20676,e=>{"use strict";function t(e,t){return Math.floor(Math.random()*(t-e+1))+e}function r(e){return new Promise(t=>setTimeout(t,e))}async function a(){let e=t(500,3e3);await r(e)}async function i(){let e=t(3e3,8e3);await r(e)}function s(e=1){let t=[];for(let r=0;r<e;r++){let e=new Uint8Array(32);crypto.getRandomValues(e);let r=Array.from(e).map(e=>e.toString(16).padStart(2,"0")).join("");t.push(r)}return t}function n(e){let t=[...e];for(let e=t.length-1;e>0;e--){let r=Math.floor(Math.random()*(e+1));[t[e],t[r]]=[t[r],t[e]]}return t}function l(e){let r=[],a=[...e];for(;a.length>0;){let e=Math.min(t(3,7),a.length);r.push(a.slice(0,e)),a=a.slice(e)}return r}Date.now(),e.s(["applyBatchDelay",()=>i,"applyRequestJitter",()=>a,"createBatches",()=>l,"generateDecoyTxids",()=>s,"shuffleArray",()=>n])},25593,e=>{"use strict";var t=e.i(43476),r=e.i(71645),a=e.i(15288),i=e.i(19455),s=e.i(24687),n=e.i(74153),l=e.i(81611);async function o(e){let t=Uint8Array.from(atob(e),e=>e.charCodeAt(0));return Array.from(new Uint8Array(await crypto.subtle.digest("SHA-256",t))).map(e=>e.toString(16).padStart(2,"0")).join("")}function d({onStatusChange:e}){let{save:d,refresh:c}=(0,n.useBeefStore)(),{dossiers:h,save:u}=(0,l.useDossiers)(),[f,g]=r.useState(""),x=async()=>{if(e(null),!f.trim())return void e("Please paste BEEF data to import.");try{let t,r=JSON.parse(f);t=Array.isArray(r)?r:[r];let a=0,i=0;for(let e of t){if(!e.txid||!e.beef)continue;let t=e.beef,r=await o(t),s={txid:e.txid,beef:t,beef_hash:r,height:e.height??0,header_hash:e.header_hash??"",utxos:e.utxos??[],labels:e.labels??[],bucket:e.bucket??"",created_at:new Date().toISOString(),integrity:{archive_hash:r,algo:"sha256"}};if((await d(s)).ok)for(let e of(a++,h))e.funding_txid===s.txid&&!e.beef_hash&&(await u({...e,beef_hash:r}),i++)}g(""),await c(),e(`Imported ${a} BEEF archive(s).${i>0?` Linked to ${i} dossier(s).`:""}`)}catch(t){e(`Import error: ${t instanceof Error?t.message:"Unknown"}`)}};return(0,t.jsxs)(a.Card,{children:[(0,t.jsx)(a.CardHeader,{children:(0,t.jsx)(a.CardTitle,{children:"Import BEEF"})}),(0,t.jsxs)(a.CardContent,{className:"space-y-4",children:[(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Paste BEEF JSON data (single object or array) to import proof archives."}),(0,t.jsx)(s.Textarea,{placeholder:'{"txid": "...", "beef": "base64...", "height": 123456}',value:f,onChange:e=>g(e.target.value),rows:6}),(0,t.jsx)(i.Button,{onClick:x,children:"Import"})]})]})}e.s(["BeefImport",()=>d])},77936,58004,76307,5081,e=>{"use strict";e.i(25593);var t=e.i(43476),r=e.i(71645),a=e.i(15288),i=e.i(19455),s=e.i(93479),n=e.i(87486),l=e.i(74153),o=e.i(81611),d=e.i(28409),c=e.i(4303),h=e.i(20676);async function u(e){let t=Uint8Array.from(atob(e),e=>e.charCodeAt(0));return Array.from(new Uint8Array(await crypto.subtle.digest("SHA-256",t))).map(e=>e.toString(16).padStart(2,"0")).join("")}function f({onStatusChange:e,initialTxid:f="",autoTriggerBatch:g,onAutoTriggerComplete:x}){let{archives:m,save:p,refresh:v}=(0,l.useBeefStore)(),{dossiers:b,save:y}=(0,o.useDossiers)(),{mode:w,requestOnline:j}=(0,d.useNetworkMode)(),[k,N]=r.useState(f),[B,S]=r.useState(!1),[C,H]=r.useState(!1),[E,$]=r.useState(null),[A,F]=r.useState(!1);r.useEffect(()=>{f&&N(f)},[f]),r.useEffect(()=>{let e=b.filter(e=>!e.beef_hash);g&&"online_shielded"===w&&!A&&e.length>0&&(F(!0),T().then(()=>{x?.()}))},[g,w,A,b]);let _=async()=>{if(e(null),"online_shielded"!==w&&!await j())return void e("Cancelled. Stay in Offline mode.");let t=k.trim().toLowerCase();if(!t||64!==t.length)return void e("Please enter a valid 64-character txid.");let r=m.find(e=>e.txid===t),a=!1;if(r){if(!window.confirm("BEEF for this txid already exists. Re-fetch to replace it?"))return void e("Cancelled. Existing BEEF kept.");a=!0}S(!0);try{let i=await (0,c.assembleBeefFromTxid)(t);if(!i)return void e("Could not fetch BEEF. The transaction may be unconfirmed or the proof unavailable.");let s=(e=>{let t=new Uint8Array(e.length/2);for(let r=0;r<e.length;r+=2)t[r/2]=parseInt(e.substr(r,2),16);return t})(i.beefHex),n=btoa(String.fromCharCode(...s)),l=await u(n),o={txid:t,beef:n,beef_hash:l,height:i.height,header_hash:"",utxos:r?.utxos??[],labels:r?.labels??[],bucket:r?.bucket??"",created_at:r?.created_at??new Date().toISOString(),integrity:{archive_hash:l,algo:"sha256"}},d=await p(o,{force:a});if(!d.ok)return void e(`Save failed: ${d.message}`);let h=0;for(let e of b)e.funding_txid===t&&!e.beef_hash&&(await y({...e,beef_hash:l}),h++);N(""),await v(),e(`BEEF fetched and stored for ${t.slice(0,8)}... (height ${i.height})${h>0?`. Linked to ${h} dossier(s).`:""}`)}catch(t){e(`Fetch error: ${t instanceof Error?t.message:"Unknown"}`)}finally{S(!1)}},T=async()=>{if(e(null),"online_shielded"!==w&&!await j())return void e("Cancelled. Stay in Offline mode.");let t=b.filter(e=>!e.beef_hash);if(0===t.length)return void e("All dossiers already have BEEF proofs!");let r=[...new Set(t.map(e=>e.funding_txid))],a=(0,h.createBatches)(r).map(e=>{let t=Math.floor(2*Math.random())+1,r=(0,h.generateDecoyTxids)(t);return{items:(0,h.shuffleArray)([...e,...r]),realTxids:new Set(e)}});H(!0),$({current:0,total:r.length,success:0,failed:0});let i=0,s=0,n=0;for(let e=0;e<a.length;e++){let{items:l,realTxids:o}=a[e];for(let e=0;e<l.length;e++){let a=l[e],d=!o.has(a);d||$({current:++n,total:r.length,success:i,failed:s});try{let e=await (0,c.assembleBeefFromTxid)(a);if(d)continue;if(e){let r=(e=>{let t=new Uint8Array(e.length/2);for(let r=0;r<e.length;r+=2)t[r/2]=parseInt(e.substr(r,2),16);return t})(e.beefHex),n=btoa(String.fromCharCode(...r)),l=await u(n),o={txid:a,beef:n,beef_hash:l,height:e.height,header_hash:"",utxos:[],labels:[],bucket:"",created_at:new Date().toISOString(),integrity:{archive_hash:l,algo:"sha256"}};if((await p(o)).ok){for(let e of t.filter(e=>e.funding_txid===a))await y({...e,beef_hash:l});i++}else s++}else s++}catch{!d&&s++}e<l.length-1&&await (0,h.applyRequestJitter)()}e<a.length-1&&await (0,h.applyBatchDelay)()}$({current:r.length,total:r.length,success:i,failed:s}),await v(),e(`Batch fetch complete: ${i} succeeded, ${s} failed.`),H(!1)},R=b.filter(e=>!e.beef_hash).length;return(0,t.jsxs)(a.Card,{id:"fetch-beef-section",children:[(0,t.jsx)(a.CardHeader,{children:(0,t.jsx)(a.CardTitle,{children:"Fetch BEEF from Network"})}),(0,t.jsxs)(a.CardContent,{className:"space-y-4",children:[(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Enter a txid to fetch its BEEF proof from WhatsOnChain (requires Online mode)."}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(s.Input,{placeholder:"Transaction ID (64 hex characters)",value:k,onChange:e=>N(e.target.value.toLowerCase()),className:"font-mono text-xs"}),(0,t.jsx)(i.Button,{onClick:_,disabled:B,children:B?"Fetching...":"Fetch BEEF"})]}),R>0&&(0,t.jsxs)("div",{className:"rounded-md border p-3 space-y-2",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("span",{className:"text-sm",children:[(0,t.jsx)(n.Badge,{variant:"outline",className:"mr-2",children:R}),"dossiers missing BEEF"]}),(0,t.jsx)(i.Button,{size:"sm",onClick:T,disabled:C,children:C?"Fetching...":"Fetch All Missing"})]}),E&&(0,t.jsxs)("div",{className:"text-xs text-muted-foreground",children:["Progress: ",E.current,"/",E.total," •"," ",(0,t.jsxs)("span",{className:"text-green-600",children:[E.success," ok"]})," •"," ",(0,t.jsxs)("span",{className:"text-red-500",children:[E.failed," failed"]})]})]}),"online_shielded"!==w&&(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"Currently offline. Clicking fetch will prompt to go online."})]})]})}e.s(["BeefFetch",()=>f],58004);var g=e.i(28860);e.i(51185);var x=e.i(83612),m=e.i(72988);async function p(e){try{let t=x.Beef.fromString(e,"base64"),r=t.getValidTxids();if(0===r.length)return{ok:!1,txid:null,height:null,merkleRoot:null,error:"No valid transactions found in BEEF"};let a=r[r.length-1],i=t.findBump(a);if(!i)return{ok:!1,txid:a,height:null,merkleRoot:null,error:"No merkle path found for subject transaction"};let s=i.blockHeight,n=i.computeRoot(a);if(!await ({async isValidRootForHeight(e,t){let r=await (0,m.getHeaderByHeight)(t);return!!r&&r.merkle_root.toLowerCase()===e.toLowerCase()},currentHeight:async()=>await (0,m.getTipHeight)()??0}).isValidRootForHeight(n,s)){let e=await (0,m.getHeaderByHeight)(s),t=await (0,m.getTipHeight)();if(!e){let e=null===t||s>t;return{ok:!1,txid:a,height:s,merkleRoot:n,error:e?`Missing header at height ${s.toLocaleString()}. Sync headers to height ${s.toLocaleString()} or higher.`:`Missing header at height ${s.toLocaleString()} (tip is ${t?.toLocaleString()}). Headers may have gaps.`,missingHeaders:!0}}return{ok:!1,txid:a,height:s,merkleRoot:n,error:`Merkle root mismatch at height ${s.toLocaleString()}. Proof may be invalid.`}}return{ok:!0,txid:a,height:s,merkleRoot:n,error:null}}catch(e){return{ok:!1,txid:null,height:null,merkleRoot:null,error:`Parse error: ${e instanceof Error?e.message:"Unknown error"}`}}}function v({onStatusChange:e,verifyResults:s,setVerifyResults:u,autoTrigger:f,onAutoTriggerComplete:v}){let{archives:b,loading:y,verifyIntegrity:w}=(0,l.useBeefStore)(),{dossiers:j,save:k}=(0,o.useDossiers)(),{tipHeight:N,headerCount:B}=(0,g.useHeaderStore)(),{mode:S,requestOnline:C}=(0,d.useNetworkMode)(),[H,E]=r.useState(!1),[$,A]=r.useState(!1),[F,_]=r.useState(!1),[T,R]=r.useState(null),I=async()=>{e(null),R(null);try{let t=await w();R(t),0===t.invalid.length?e(`Integrity check passed: ${t.valid} of ${t.total} BEEF archives valid.`):e(`Integrity check found ${t.invalid.length} invalid BEEF archive(s).`)}catch(t){e(`Integrity check error: ${t instanceof Error?t.message:"Unknown"}`)}};r.useEffect(()=>{f&&!y&&!F&&b.length>0&&(_(!0),M().then(()=>{v?.()}))},[f,y,F,b.length]);let U=async()=>{let e=new Map;for(let t of b){if(!t.beef)continue;let r=await p(t.beef);for(let a of(e.set(t.txid,r),u(e=>{let a=new Map(e);return a.set(t.txid,r),a}),j.filter(e=>e.funding_txid===t.txid)))await k({...a,verified:{at_height:N??0,ok:r.ok,checked_at:new Date().toISOString()}})}return e},M=async()=>{e(null),E(!0);try{e("Verifying proofs...");let t=await U(),r=Array.from(t.entries()).filter(([e,t])=>!t.ok&&t.missingHeaders);if(r.length>0){if("online_shielded"!==S&&!await C()){let a=Array.from(t.values()).filter(e=>e.ok).length;e(`Verified: ${a} of ${b.length}. ${r.length} need headers (stayed offline).`);return}e(`Fetching ${r.length} missing headers...`),A(!0);let a=new Set;for(let e of b)if(e.beef){e.height&&e.height>0&&(await (0,m.getHeaderByHeight)(e.height)||a.add(e.height));try{let t=Uint8Array.from(atob(e.beef),e=>e.charCodeAt(0));for(let e of x.Beef.fromBinary(Array.from(t)).bumps)await (0,m.getHeaderByHeight)(e.blockHeight)||a.add(e.blockHeight)}catch{}}let i=Array.from(a).sort((e,t)=>e-t),s=0;for(let t of i){try{let e=await (0,c.fetchHeaderByHeight)(t);e&&(await (0,m.saveHeader)({height:e.height,hash:e.hash,prev_hash:e.prevBlockHash,merkle_root:e.merkleRoot,timestamp:e.time,header_hex:(0,c.constructHeaderHex)(e)}),s++)}catch(e){console.warn(`Failed to fetch header ${t}:`,e)}await (0,h.applyRequestJitter)(),s%3==0&&e(`Fetched ${s} of ${i.length} headers...`)}A(!1),e("Re-verifying with new headers..."),t=await U()}let a=Array.from(t.values()).filter(e=>e.ok).length,i=Array.from(t.values()).filter(e=>!e.ok&&e.missingHeaders).length,s=Array.from(t.values()).filter(e=>!e.ok&&!e.missingHeaders).length,n=`✓ Verified: ${a} of ${b.length}.`;i>0&&(n+=` ${i} still need headers.`),s>0&&(n+=` ${s} failed verification.`),e(n)}catch(t){e(`Verification error: ${t instanceof Error?t.message:"Unknown"}`)}finally{E(!1),A(!1)}};return(0,t.jsxs)(a.Card,{children:[(0,t.jsx)(a.CardHeader,{children:(0,t.jsx)(a.CardTitle,{children:"Verify Proofs"})}),(0,t.jsxs)(a.CardContent,{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4 text-sm",children:[(0,t.jsxs)(n.Badge,{variant:"outline",children:[B," headers stored"]}),(0,t.jsxs)(n.Badge,{variant:"outline",children:["Tip: ",N??"none"]}),(0,t.jsxs)(n.Badge,{variant:"outline",children:[b.length," BEEF archives"]})]}),(0,t.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,t.jsx)(i.Button,{onClick:I,variant:"outline",disabled:0===b.length,children:"Integrity Check"}),(0,t.jsx)(i.Button,{onClick:M,disabled:H||$||0===b.length,children:H?"Verifying...":$?"Fetching Headers...":"Verify All"})]}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:'"Verify All" will automatically fetch any missing headers needed for verification.'}),T&&(0,t.jsx)("div",{className:`rounded-md border p-3 text-sm ${0===T.invalid.length?"border-green-500/30 bg-green-500/5 text-green-700 dark:text-green-400":"border-red-500/30 bg-red-500/5 text-red-700 dark:text-red-400"}`,children:0===T.invalid.length?(0,t.jsxs)("p",{children:["✓ All ",T.valid," BEEF archives passed integrity check."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("p",{children:["✗ ",T.invalid.length," invalid archive(s):"]}),(0,t.jsx)("ul",{className:"mt-1 list-inside list-disc text-xs",children:T.invalid.slice(0,5).map(e=>(0,t.jsx)("li",{className:"truncate",children:e},e))})]})})]})]})}function b({verifyResults:e,onRefetchRequest:r}){let{archives:a,loading:s}=(0,l.useBeefStore)(),{dossiers:c}=(0,o.useDossiers)(),{mode:h}=(0,d.useNetworkMode)();return s?(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Loading..."}):0===a.length?(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"No BEEF archives stored yet."}):(0,t.jsxs)("div",{className:"space-y-2",children:[a.slice(0,20).map(a=>{let s,l=e.get(a.txid),o=(s=a.txid,c.filter(e=>e.funding_txid===s).length),d=l?.ok?{borderColor:"rgba(22, 163, 74, 0.3)",backgroundColor:"rgba(22, 163, 74, 0.1)"}:l&&!l.ok?{borderColor:"rgba(239, 68, 68, 0.3)",backgroundColor:"rgba(239, 68, 68, 0.05)"}:{};return(0,t.jsxs)("div",{className:"rounded-md border p-3 text-sm bg-card/60",style:d,children:[(0,t.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,t.jsx)("code",{className:"truncate text-xs",children:a.txid}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[l&&(0,t.jsx)(n.Badge,{variant:l.ok?"default":"destructive",className:"text-xs",children:l.ok?"✓ Verified":"✗ Failed"}),(0,t.jsxs)(n.Badge,{variant:"outline",className:"text-xs",children:["Height ",a.height]})]})]}),(0,t.jsxs)("p",{className:"mt-1 text-xs text-muted-foreground",children:[o>0?(0,t.jsxs)("span",{className:"text-blue-600 dark:text-blue-400",children:["Proves ",o," UTXO",1!==o?"s":""]}):(0,t.jsx)("span",{children:"No linked UTXOs"}),a.bucket&&(0,t.jsxs)("span",{children:[" • Bucket: ",a.bucket]}),l&&!l.ok&&l.error&&(0,t.jsxs)("span",{className:"ml-2 text-red-500",children:["— ",l.error]})]}),l&&!l.ok&&l.error?.includes("Parse error")&&"online_shielded"===h&&(0,t.jsx)(i.Button,{size:"sm",variant:"outline",className:"mt-2",onClick:()=>r(a.txid),children:"Re-fetch BEEF (corrupted)"})]},a.txid)}),a.length>20&&(0,t.jsxs)("p",{className:"text-xs text-muted-foreground",children:["...and ",a.length-20," more"]})]})}e.s(["BeefVerify",()=>v],76307),e.s(["BeefArchiveList",()=>b],5081),e.s([],77936)},81704,e=>{"use strict";var t=e.i(43476),r=e.i(71645),a=e.i(18566),i=e.i(19455),s=e.i(72436),n=e.i(28409),l=e.i(74153),o=e.i(28860),d=e.i(81611),c=e.i(15288),h=e.i(87486),u=e.i(24687),f=e.i(72988),g=e.i(4303),x=e.i(20676);function m({onStatusChange:e,compact:a=!1}){let{mode:s,requestOnline:l}=(0,n.useNetworkMode)(),{tipHeight:d,headerCount:m,refresh:p}=(0,o.useHeaderStore)(),[v,b]=r.useState(!1),[y,w]=r.useState(null),[j,k]=r.useState(""),[N,B]=r.useState(!1),S=async()=>{if("online_shielded"!==s&&!await l())return void e("Cancelled. Stay in Offline mode.");b(!0),w("Fetching chain tip from sources...");try{let t=await (0,g.fetchChainTipMultiSource)();if(!t.height)return void e("Could not fetch chain tip from any source.");let r=t.height,a=t.consensus?`✓ Consensus from ${t.sources.join(", ")}`:`⚠ Single source: ${t.sources.join(", ")}`;w(`Chain tip: ${r} (${a})`),await new Promise(e=>setTimeout(e,1e3));let i=await (0,f.getTipHeight)(),s=i?i+1:r-100;if(s>r)return void e(`Headers are up to date. ${a}`);let n=Math.min(r-s+1,200);w(`Fetching ${n} headers from ${s}...`);let l=0;for(let e=s;e<=Math.min(s+n-1,r);e++){let t=await (0,g.fetchHeaderByHeight)(e);t&&(await (0,f.saveHeader)({height:t.height,hash:t.hash,prev_hash:t.prevBlockHash,merkle_root:t.merkleRoot,timestamp:t.time,header_hex:(0,g.constructHeaderHex)(t)}),l++),l%10==0&&w(`Fetched ${l} of ${n} headers...`),await (0,x.applyRequestJitter)()}await p(),e(`Fetched ${l} headers. Tip: ${r}. ${a}`)}catch(t){e(`Fetch error: ${t instanceof Error?t.message:"Unknown"}`)}finally{b(!1),w(null)}},C=async()=>{try{let t=await (0,f.exportHeaderStore)(),r=JSON.stringify(t,null,2),a=new Blob([r],{type:"application/json"}),i=URL.createObjectURL(a),s=document.createElement("a");s.href=i,s.download=`chronicle-headers-${new Date().toISOString().slice(0,10)}.json`,s.click(),URL.revokeObjectURL(i),e("Headers exported successfully.")}catch(t){e(`Export error: ${t instanceof Error?t.message:"Unknown"}`)}},H=async()=>{if(!j.trim())return void e("Please paste header data to import.");try{let t=JSON.parse(j);if(!t.version||!Array.isArray(t.headers))return void e("Invalid header snapshot format.");await (0,f.importHeaderStore)(t),await p(),k(""),B(!1),e(`Imported ${t.headers.length} headers. Tip: ${t.tipHeight}`)}catch(t){e(`Import error: ${t instanceof Error?t.message:"Unknown"}`)}};return(0,t.jsxs)(c.Card,{children:[(0,t.jsx)(c.CardHeader,{className:"pb-3",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)(c.CardTitle,{className:"text-base",children:"Block Headers"}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)(h.Badge,{variant:"outline",className:"text-xs",children:[m," stored"]}),(0,t.jsxs)(h.Badge,{variant:"outline",className:"text-xs",children:["Tip: ",d??"none"]})]})]})}),(0,t.jsxs)(c.CardContent,{className:"space-y-3",children:[y&&(0,t.jsx)("div",{className:"rounded-md border border-yellow-500/20 bg-yellow-500/5 p-2 text-xs text-yellow-600 dark:text-yellow-400",children:y}),(0,t.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,t.jsx)(i.Button,{size:"sm",onClick:S,disabled:v,children:v?"Syncing...":"Sync Headers"}),(0,t.jsx)(i.Button,{size:"sm",variant:"outline",onClick:C,children:"Export"}),(0,t.jsx)(i.Button,{size:"sm",variant:"outline",onClick:()=>B(!N),children:N?"Cancel":"Import"})]}),N&&(0,t.jsxs)("div",{className:"space-y-2 border-t pt-3",children:[(0,t.jsx)(u.Textarea,{placeholder:'{"version": 1, "tipHeight": 123456, "headers": [...]}',value:j,onChange:e=>k(e.target.value),rows:4,className:"text-xs"}),(0,t.jsx)(i.Button,{size:"sm",onClick:H,children:"Import Headers"})]}),"online_shielded"!==s&&(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:'Currently offline. Click "Sync Headers" to go online and fetch.'})]})]})}e.i(77936);var p=e.i(76307),v=e.i(58004),b=e.i(25593),y=e.i(5081);function w(){return(0,t.jsx)(r.Suspense,{fallback:(0,t.jsx)("div",{children:"Loading..."}),children:(0,t.jsx)(j,{})})}function j(){let e=(0,a.useSearchParams)(),{mode:c}=(0,n.useNetworkMode)(),{archives:h}=(0,l.useBeefStore)(),{headerCount:u}=(0,o.useHeaderStore)(),{dossiers:f}=(0,d.useDossiers)(),[g,x]=r.useState(null),[w,j]=r.useState(new Map),[k,N]=r.useState(null),[B,S]=r.useState(""),C=e.get("txid")??"";r.useEffect(()=>{let t=e.get("action");t&&N(t)},[e]);let H=()=>{N(null)},E=f.filter(e=>!e.beef_hash).length,$=f.filter(e=>e.beef_hash&&!e.verified?.ok).length,A=f.filter(e=>e.verified?.ok).length;return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("h1",{className:"text-2xl font-semibold tracking-tight",children:"Validation"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Sync headers and verify BEEF proofs for your UTXOs."})]}),(0,t.jsxs)("div",{className:"grid gap-4 md:grid-cols-4",children:[(0,t.jsxs)("div",{className:"rounded-md border p-3 text-center",children:[(0,t.jsx)("p",{className:"text-2xl font-bold",children:u}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"Headers"})]}),(0,t.jsxs)("div",{className:"rounded-md border p-3 text-center",children:[(0,t.jsx)("p",{className:"text-2xl font-bold",children:h.length}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"BEEF Archives"})]}),(0,t.jsxs)("div",{className:"rounded-md border p-3 text-center",children:[(0,t.jsx)("p",{className:"text-2xl font-bold",style:{color:A>0?"#16a34a":void 0},children:A}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"Verified"})]}),(0,t.jsxs)("div",{className:"rounded-md border p-3 text-center",children:[(0,t.jsx)("p",{className:"text-2xl font-bold",style:{color:E>0?"#eab308":void 0},children:E+$}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"Need Attention"})]})]}),"online_shielded"===c&&(E>0||$>0)&&(0,t.jsx)("div",{className:"rounded-md border border-primary/30 bg-primary/5 p-4",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-medium",children:"Quick Actions"}),(0,t.jsxs)("p",{className:"text-sm text-muted-foreground",children:[E>0&&`${E} UTXOs need BEEF. `,$>0&&`${$} proofs need verification.`]})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[E>0&&(0,t.jsx)(i.Button,{size:"sm",onClick:()=>N("batch"),children:"Fetch All BEEF"}),$>0&&(0,t.jsx)(i.Button,{size:"sm",variant:"outline",onClick:()=>N("verify"),children:"Verify All"})]})]})}),g&&(0,t.jsx)("div",{className:"rounded-md border border-blue-500/20 bg-blue-500/5 p-3 text-sm text-blue-600 dark:text-blue-400",children:g}),(0,t.jsx)(m,{onStatusChange:x}),(0,t.jsx)(s.Separator,{}),(0,t.jsx)(p.BeefVerify,{onStatusChange:x,verifyResults:w,setVerifyResults:j,autoTrigger:"verify"===k,onAutoTriggerComplete:H}),(0,t.jsx)(s.Separator,{}),(0,t.jsx)(v.BeefFetch,{onStatusChange:x,initialTxid:B||C,autoTriggerBatch:"batch"===k,onAutoTriggerComplete:H}),(0,t.jsx)(s.Separator,{}),(0,t.jsx)(b.BeefImport,{onStatusChange:x}),(0,t.jsx)(s.Separator,{}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("h2",{className:"text-lg font-semibold",children:"Stored BEEF Archives"}),(0,t.jsx)(y.BeefArchiveList,{verifyResults:w,onRefetchRequest:e=>{S(e),document.getElementById("fetch-beef-section")?.scrollIntoView({behavior:"smooth"})}})]})]})}e.s(["default",()=>w],81704)},28627,e=>{e.v(t=>Promise.all(["static/chunks/4c8470885cb93521.js"].map(t=>e.l(t))).then(()=>t(44270)))}]);